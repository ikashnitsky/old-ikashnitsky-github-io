<?xml version="1.0" encoding="utf-8"?><?xml-stylesheet type="text/xml" href="http://localhost:4000/feed.xslt.xml"?><feed xmlns="http://www.w3.org/2005/Atom"><generator uri="http://jekyllrb.com" version="3.4.0">Jekyll</generator><link href="http://localhost:4000/atom.xml" rel="self" type="application/atom+xml" /><link href="http://localhost:4000/" rel="alternate" type="text/html" /><updated>2017-02-19T12:32:05+01:00</updated><id>http://localhost:4000//</id><title type="html">Ilya Kashnitsky</title><subtitle>Personal website of Ilya Kashnitsky</subtitle><author><name>ilya</name></author><entry><title type="html">30 issues of Demographic Digest - the most frequent journals</title><link href="http://localhost:4000/2017/dd-journals-frequency/" rel="alternate" type="text/html" title="30 issues of Demographic Digest - the most frequent journals" /><published>2017-02-14T00:00:00+01:00</published><updated>2017-02-14T00:00:00+01:00</updated><id>http://localhost:4000/2017/dd-journals-frequency</id><content type="html" xml:base="http://localhost:4000/2017/dd-journals-frequency/">&lt;p&gt;This week, the 30-th issue of my Demographic Digest &lt;a href=&quot;http://demoscope.ru/weekly/2017/0715/digest01.php&quot;&gt;was published&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;/dd&quot;&gt;Demographic Digest&lt;/a&gt; is my project that started in November 2015. Twice a month I select fresh demographic papers and write brief summaries of them in Russian to be published in &lt;a href=&quot;http://demoscope.ru&quot;&gt;Demoscope Weekly&lt;/a&gt;, the most popular Russian journal/website in social sciences. If you read Russian, you may want to browse &lt;a href=&quot;http://demoscope.ru/weekly/arc/arcdigest.php&quot;&gt;the archive&lt;/a&gt; or visit &lt;a href=&quot;https://ikashnitsky.github.io/dem-digest/&quot;&gt;the website&lt;/a&gt; of the project (which is still to be filled).&lt;/p&gt;

&lt;p&gt;The project is in the transitional phase now. Since 2016 Demographic Digest welcomes contributions from from external authors. In February 2017 I launched the &lt;a href=&quot;https://www.hse.ru/org/hse/pfair/199751652.html&quot;&gt;first iteration of a project&lt;/a&gt; for the students of National Research University Higher School of Economics.&lt;/p&gt;

&lt;p&gt;To draw a line after the first phase of the project, I analysed what journals supplied Demographic Digest most frequently. Also, my desire was to try visualizing data with treemaps, which I mentioned in the bonus part&lt;sup id=&quot;fnref:1&quot;&gt;&lt;a href=&quot;#fn:1&quot; class=&quot;footnote&quot;&gt;1&lt;/a&gt;&lt;/sup&gt; of &lt;a href=&quot;http://demoscope.ru/weekly/2017/0715/digest03.php&quot;&gt;the latest digest issue&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;For that, I exported the bibliographic data of all the papers covered in Demographic Digest. I use &lt;a href=&quot;https://www.zotero.org&quot;&gt;Zotero&lt;/a&gt; as a reference manager; the paper records are exported as a single .bib file, which I then saved as a &lt;a href=&quot;/doc/misc/dd-stats/dd-bib.txt&quot;&gt;plain text (.txt) file&lt;/a&gt;. Then I read this data in R, cleaned it, and finally visualized.&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# load required packages
library(tidyverse)
library(stringr)
library(readxl)
library(extrafont)
myfont &amp;lt;- &quot;Roboto Condensed&quot;

df &amp;lt;- data.frame(lines = readLines(&quot;https://ikashnitsky.github.io/doc/misc/dd-stats/dd-bib.txt&quot;)) %&amp;gt;% 
        mutate(lines = lines %&amp;gt;% as.character()) %&amp;gt;% 
        
        # grab only the lines that contain journals' titles
        filter(lines %&amp;gt;% str_detect(&quot;journaltitle&quot;)) %&amp;gt;% 
        
        # remove everything that is not the bare journal's title
        transmute(journals = lines %&amp;gt;% 
                       str_replace_all(pattern = &quot;\tjournaltitle = |\\Q{\\E|\\Q}\\E,|\\Q}\\E&quot;, 
                                       replacement = &quot;&quot;)) %&amp;gt;% 
        # calculate frequencies
        group_by(journals) %&amp;gt;% 
        summarise(n = n())
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;For one journal title, Ageing and Society, I failed to replace the “\&amp;amp;” using &lt;a href=&quot;https://www.rstudio.com/wp-content/uploads/2016/09/RegExCheatsheet.pdf&quot;&gt;regular expressions&lt;/a&gt;. This one is to be fixed manually. I also corrected the title of Lancet journal removing the article “The”. Finally, I corrected the frequencies for Population Studies and Population and Development Review subtracting 6, because for both journals I provided lists of most cited papers as a bonus. Following the same logic, I cleaned the data from the papers that appeared in the bonus part.&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# correct &quot;Ageing and Society&quot;
df[1,1] &amp;lt;- &quot;Ageing and Society&quot;

# correct the title of Lancet
df &amp;lt;- df %&amp;gt;% mutate(journals = journals %&amp;gt;% str_replace(&quot;The Lancet&quot;, &quot;Lancet&quot;))

# correct &quot;Population and Development Review&quot; and &quot;Population Studies&quot; for 6 each
# Reason - top cited papers bonus
df[df$journals %in% c(&quot;Population and Development Review&quot;, &quot;Population Studies&quot;), 2] &amp;lt;- 
        df[df$journals %in% c(&quot;Population and Development Review&quot;, &quot;Population Studies&quot;), 2] - 6
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;To provide some additional metrics of the journals, I downloaded bibliometric data from the &lt;a href=&quot;&quot;&gt;SCImago Journal &amp;amp; Country Rank project&lt;/a&gt;http://www.scimagojr.com/aboutus.php. Demographic journals usually have rather low SJR, compared to medical journals; that’s why I downloaded the data only for journals in &lt;a href=&quot;http://www.scimagojr.com/journalrank.php?area=3300&quot;&gt;Social Sciences&lt;/a&gt; (the&lt;a href=&quot;/doc/misc/dd-stats/scimagojr.xlsx&quot;&gt;.xlsx file&lt;/a&gt;). Then I read the data in R and join to my data frame.&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# read SJR data for journals in Social Sciences
sjr &amp;lt;- readxl::read_excel(&quot;https://ikashnitsky.github.io/doc/misc/dd-stats/scimagojr.xlsx&quot;, 1) %&amp;gt;% 
        mutate(id = Title %&amp;gt;% tolower())

# join the data frames; note that I create an &quot;id&quot; variable in lower case
df_sjr &amp;lt;- left_join(df %&amp;gt;% mutate(id = journals %&amp;gt;% tolower), sjr, &quot;id&quot;) 
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;Finally, it’s time to visualize the data. I use the amazing &lt;code class=&quot;highlighter-rouge&quot;&gt;treemap&lt;/code&gt; package&lt;sup id=&quot;fnref:2&quot;&gt;&lt;a href=&quot;#fn:2&quot; class=&quot;footnote&quot;&gt;2&lt;/a&gt;&lt;/sup&gt;.&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# Treemap visualization
library(treemap)

treemap(dtf = df_sjr, 
        index = &quot;journals&quot;, 
        vSize = &quot;n&quot;, 
        vColor = &quot;SJR&quot;, 
        type = &quot;value&quot;,
        n = 5,
        palette = &quot;BrBG&quot;, 
        border.col = &quot;grey10&quot;, 
        title = &quot;Journals' frequency in Demographic Digest&quot;,
        title.legend = &quot;SJR (only social sciences)&quot;,
        fontfamily.title = myfont,
        fontfamily.labels = myfont,
        fontfamily.legend = myfont,
        drop.unused.levels = T)
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;h2 id=&quot;here-is-how-the-output-looks&quot;&gt;Here is how the output looks&lt;/h2&gt;
&lt;p&gt;&lt;a href=&quot;/images/170214/treemap-dd-stats.png&quot;&gt;&lt;img src=&quot;/images/170214/treemap-dd-stats.png&quot; alt=&quot;treemap&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Note that the lion’s share of Population Studies is mainly explained by &lt;a href=&quot;http://demoscope.ru/weekly/2015/0661/digest01.php&quot;&gt;the first issue of Demographic Digest&lt;/a&gt;, in which I covered all the papers from the brilliant special issue &lt;a href=&quot;http://www.tandfonline.com/toc/rpst20/69/sup1&quot;&gt;Population — The long view&lt;/a&gt;.&lt;/p&gt;

&lt;div class=&quot;footnotes&quot;&gt;
  &lt;ol&gt;
    &lt;li id=&quot;fn:1&quot;&gt;
      &lt;p&gt;I finish each issue of Demographic Digest with a bonus, in with I cover fun papers, discuss some academia related issues, or just provide link to cool visualizations and projects.&amp;nbsp;&lt;a href=&quot;#fnref:1&quot; class=&quot;reversefootnote&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
    &lt;/li&gt;
    &lt;li id=&quot;fn:2&quot;&gt;
      &lt;p&gt;I also tried &lt;code class=&quot;highlighter-rouge&quot;&gt;portfolio&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;treemapify&lt;/code&gt;, but liked the output from &lt;code class=&quot;highlighter-rouge&quot;&gt;treemap&lt;/code&gt; most.&amp;nbsp;&lt;a href=&quot;#fnref:2&quot; class=&quot;reversefootnote&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
    &lt;/li&gt;
  &lt;/ol&gt;
&lt;/div&gt;</content><author><name>Ilya Kashnitsky</name><email>ilya.kashnitsky@gmail.com</email></author><summary type="html">This week, the 30-th issue of my Demographic Digest was published.</summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="http://localhost:4000/%7B%22teaser%22=%3E%22170214-teaser.png%22%7D" /></entry><entry><title type="html">Male mortality in Russia and Japan</title><link href="http://localhost:4000/2017/hmd-male-mortality-rus-jpn/" rel="alternate" type="text/html" title="Male mortality in Russia and Japan" /><published>2017-02-06T00:00:00+01:00</published><updated>2017-02-06T00:00:00+01:00</updated><id>http://localhost:4000/2017/hmd-male-mortality-rus-jpn</id><content type="html" xml:base="http://localhost:4000/2017/hmd-male-mortality-rus-jpn/">&lt;p&gt;Russia is sadly notorious for its ridiculously high adult male mortality. According to &lt;a href=&quot;http://www.mortality.org&quot;&gt;Human Mortality Database data (2010)&lt;/a&gt;, the probability for a Russian men to survive from 20 to 60 was just 0.64 &lt;sup id=&quot;fnref:1&quot;&gt;&lt;a href=&quot;#fn:1&quot; class=&quot;footnote&quot;&gt;1&lt;/a&gt;&lt;/sup&gt;. For women the probability is 0.87. This huge gender disproportion in mortality results in a peculiar sex ratio profile (see &lt;a href=&quot;https://demotrends.wordpress.com/2015/01/14/the-land-of-babushka/&quot;&gt;my old DemoTrends post&lt;/a&gt; and &lt;a href=&quot;https://ikashnitsky.github.io/2017/hmd-sex-all-ratio&quot;&gt;the previous blog post&lt;/a&gt;).&lt;/p&gt;

&lt;p&gt;Now let’s compare age-specific mortality rates of Russian men to that of the Japanese. For years and years Japan performs best in reducing mortality. It became standard to compare mortality schedules of other countries to the Japanese one &lt;sup id=&quot;fnref:2&quot;&gt;&lt;a href=&quot;#fn:2&quot; class=&quot;footnote&quot;&gt;2&lt;/a&gt;&lt;/sup&gt;.&lt;/p&gt;

&lt;p&gt;First, I need to get HMD data for both Russian and Japanese males. Again, I am using the amazing &lt;code class=&quot;highlighter-rouge&quot;&gt;R&lt;/code&gt; package &lt;code class=&quot;highlighter-rouge&quot;&gt;HMDPFDplus&lt;/code&gt; of &lt;a href=&quot;https://sites.google.com/site/timriffepersonal/&quot;&gt;Tim Riffe&lt;/a&gt; to download HMD data with just a couple of lines of &lt;code class=&quot;highlighter-rouge&quot;&gt;R&lt;/code&gt; code.&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# load required packages
library(tidyverse) # version 1.0.0
library(HMDHFDplus) # version 1.1.8

# load life tables for men, RUS and JPN
rus &amp;lt;- readHMDweb('RUS', &quot;mltper_1x1&quot;, ik_user_hmd, ik_pass_hmd)
jpn &amp;lt;- readHMDweb('JPN', &quot;mltper_1x1&quot;, ik_user_hmd, ik_pass_hmd)
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;&lt;em&gt;Please note, the arguments &lt;code class=&quot;highlighter-rouge&quot;&gt;ik_user_hmd&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;ik_pass_hmd&lt;/code&gt; are my login credidantials at the website of &lt;a href=&quot;http://www.mortality.org&quot;&gt;Human Mortality Database&lt;/a&gt;, which are stored locally at my computer. In order to access the data, one needs to create an account at http://www.mortality.org/ and provide his own credidantials to the &lt;code class=&quot;highlighter-rouge&quot;&gt;readHMDweb()&lt;/code&gt; function.&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;Next, I select the most recent year for comparison, 2014, and compute the rate ratio of age specific mortality rates.&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# compare mortality rates for 2014
ru &amp;lt;- rus %&amp;gt;% filter(Year == 2014) %&amp;gt;% transmute(age = Age, rus = mx)
jp &amp;lt;- jpn %&amp;gt;% filter(Year == 2014) %&amp;gt;% transmute(age = Age, jpn = mx)
df &amp;lt;- left_join(jp, ru, 'age') %&amp;gt;% mutate(ru_rate = rus / jpn)
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;Finally, I plot the resulting rate ratio of male mortality in Russia and Japan.&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# get nice font
library(extrafont)
myfont &amp;lt;- &quot;Roboto Condensed&quot;

# plot
gg &amp;lt;- ggplot(df, aes(age, ru_rate)) + 
        geom_hline(yintercept = 1, color = 'red') +
        geom_line(aes(group=1)) + 
        scale_y_continuous('mortality rate ratio',
                           breaks = 0:10, labels = 0:10, limits = c(0, 10)) +
        annotate('text',x=c(0, 55), y = c(1.75,5), 
                 color = c('red','black'), hjust = 0, vjust = 1, size = 7,
                 label = c('Japan','Russia'), family = myfont) +
        ggtitle('Compare age-specific mortality of males',
                subtitle = &quot;Russia and Japan, 2014, HMD&quot;)+
        theme_bw(base_size = 15, base_family = myfont)
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;&lt;a href=&quot;/images/170206/male-mortality-compare.png&quot;&gt;&lt;img src=&quot;/images/170206/male-mortality-compare.png&quot; alt=&quot;gg&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;In the middle ages, male mortality in Russian is up to 10 times higher than in Japan!&lt;/p&gt;

&lt;p&gt;&lt;em&gt;This post is based on my earlier &lt;a href=&quot;https://twitter.com/ikashnitsky/status/792305556132331520&quot;&gt;twit&lt;/a&gt; and &lt;a href=&quot;https://gist.github.com/ikashnitsky/8df43c9a5dcd1798116ba09b336cdcf2&quot;&gt;gist&lt;/a&gt;.&lt;/em&gt;&lt;/p&gt;

&lt;div class=&quot;footnotes&quot;&gt;
  &lt;ol&gt;
    &lt;li id=&quot;fn:1&quot;&gt;
      &lt;p&gt;To compare, the same probabilities for males in some developed countries are: France (0.89), Japan (0.92), US (0.87), UK (0.91).&amp;nbsp;&lt;a href=&quot;#fnref:1&quot; class=&quot;reversefootnote&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
    &lt;/li&gt;
    &lt;li id=&quot;fn:2&quot;&gt;
      &lt;p&gt;See for example the recent &lt;a href=&quot;http://www.nidi.nl/shared/content/output/papers/nidi-wp-2017-01.pdf&quot;&gt;NIDI working paper of Balachandran et. al (2017)&lt;/a&gt;.&amp;nbsp;&lt;a href=&quot;#fnref:2&quot; class=&quot;reversefootnote&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
    &lt;/li&gt;
  &lt;/ol&gt;
&lt;/div&gt;</content><author><name>Ilya Kashnitsky</name><email>ilya.kashnitsky@gmail.com</email></author><summary type="html">Russia is sadly notorious for its ridiculously high adult male mortality. According to Human Mortality Database data (2010), the probability for a Russian men to survive from 20 to 60 was just 0.64 1. For women the probability is 0.87. This huge gender disproportion in mortality results in a peculiar sex ratio profile (see my old DemoTrends post and the previous blog post).


  
    
      To compare, the same probabilities for males in some developed countries are: France (0.89), Japan (0.92), US (0.87), UK (0.91).&amp;nbsp;&amp;#8617;</summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="http://localhost:4000/%7B%22teaser%22=%3E%22170206-teaser.png%22%7D" /></entry><entry><title type="html">Sex ratios in all countries from Human Mortality Database</title><link href="http://localhost:4000/2017/hmd-all-sex-ratio/" rel="alternate" type="text/html" title="Sex ratios in all countries from Human Mortality Database" /><published>2017-02-05T00:00:00+01:00</published><updated>2017-02-05T00:00:00+01:00</updated><id>http://localhost:4000/2017/hmd-all-sex-ratio</id><content type="html" xml:base="http://localhost:4000/2017/hmd-all-sex-ratio/">&lt;p&gt;Sex ratios reflect the two basic regularities of human demographics: 1) there are always more boys being born; 2) males experience higher mortality throughout their life-course. The sex ratio at birth does not vary dramatically&lt;sup id=&quot;fnref:1&quot;&gt;&lt;a href=&quot;#fn:1&quot; class=&quot;footnote&quot;&gt;1&lt;/a&gt;&lt;/sup&gt; and is more or less constant at the level of 105-106 boys per 100 girls. Hence, differences in the sex ratio profiles of countries mainly reflect gender gap in mortality. In this post I will compare sex ratios age profiles in all countries included in &lt;a href=&quot;http://www.mortality.org&quot;&gt;Human Mortality Database&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;R&lt;/code&gt; gives amazing opportunities to grab data fast and easy. Thanks to &lt;a href=&quot;https://sites.google.com/site/timriffepersonal/&quot;&gt;Tim Riffe’s&lt;/a&gt; &lt;code class=&quot;highlighter-rouge&quot;&gt;HMDPFDplus&lt;/code&gt; package, one can now download HMD data with just a couple of lines of &lt;code class=&quot;highlighter-rouge&quot;&gt;R&lt;/code&gt; code.&lt;/p&gt;

&lt;p&gt;There is a handy function in &lt;code class=&quot;highlighter-rouge&quot;&gt;HMDPFDplus&lt;/code&gt; package – &lt;code class=&quot;highlighter-rouge&quot;&gt;getHMDcountries()&lt;/code&gt;. It lists the codes for all countries in HMD. So it becomes really easy to loop through the database and download data for all countries.&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# load required packages
library(tidyverse) # version 1.0.0
library(HMDHFDplus) # version 1.1.8

country &amp;lt;- getHMDcountries()

exposures &amp;lt;- list()
for (i in 1: length(country)) {
        cnt &amp;lt;- country[i]
        exposures[[cnt]] &amp;lt;- readHMDweb(cnt, &quot;Exposures_1x1&quot;,
                                       ik_user_hmd, ik_pass_hmd)
        
        # let's print the progress
        paste(i,'out of',length(country)) 
}
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;&lt;em&gt;Please note, the arguments &lt;code class=&quot;highlighter-rouge&quot;&gt;ik_user_hmd&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;ik_pass_hmd&lt;/code&gt; are my login credidantials at the website of &lt;a href=&quot;http://www.mortality.org&quot;&gt;Human Mortality Database&lt;/a&gt;, which are stored locally at my computer. In order to access the data, one needs to create an account at http://www.mortality.org/ and provide his own credidantials to the &lt;code class=&quot;highlighter-rouge&quot;&gt;readHMDweb()&lt;/code&gt; function.&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;Next, I select 2012 for comparison – it is quite recent, and for most of the HMD countries there are data for 2012. The loop goes through each of the countries’ dataframe in &lt;code class=&quot;highlighter-rouge&quot;&gt;exposures&lt;/code&gt; list, selects data for 2012 and calculates sex ratio at each age. I also remove data for several populations (like East and West Germany separately).&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;sr_age &amp;lt;- list()

for (i in 1:length(exposures)) {
        di &amp;lt;- exposures[[i]]
        sr_agei &amp;lt;- di %&amp;gt;% select(Year,Age,Female,Male) %&amp;gt;% 
                filter(Year %in% 2012) %&amp;gt;%
                select(-Year) %&amp;gt;%
                transmute(country = names(exposures)[i],
                          age = Age, sr_age = Male / Female * 100)
        sr_age[[i]] &amp;lt;- sr_agei
}
sr_age &amp;lt;- bind_rows(sr_age)

# remove optional populations
sr_age &amp;lt;- sr_age %&amp;gt;% filter(!country %in% c(&quot;FRACNP&quot;,&quot;DEUTE&quot;,&quot;DEUTW&quot;,&quot;GBRCENW&quot;,&quot;GBR_NP&quot;))
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;After age 90, sex ratios become quite jerky due to the relatively small numbers of survivors. I decided to aggregate data after the age 90.&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# summarize all ages older than 90 (too jerky)
sr_age_90 &amp;lt;- sr_age %&amp;gt;% filter(age %in% 90:110) %&amp;gt;% 
        group_by(country) %&amp;gt;% summarise(sr_age = mean(sr_age, na.rm = T)) %&amp;gt;%
        ungroup() %&amp;gt;% transmute(country, age=90, sr_age)

df_plot &amp;lt;- bind_rows(sr_age %&amp;gt;% filter(!age %in% 90:110), sr_age_90)
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;Finally, I plot the resulting sex ratios.&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# get nice font
library(extrafont)
myfont &amp;lt;- &quot;Roboto Condensed&quot;

# finaly - plot
gg &amp;lt;- ggplot(df_plot, aes(age, sr_age, color = country, group = country))+
        geom_hline(yintercept = 100, color = 'grey50', size = 1)+
        geom_line(size = 1)+
        scale_y_continuous(limits = c(0, 120), expand = c(0, 0), breaks = seq(0, 120, 20))+
        scale_x_continuous(limits = c(0, 90), expand = c(0, 0), breaks = seq(0, 80, 20))+
        xlab('Age')+
        ylab('Sex ratio, males per 100 females')+
        facet_wrap(~country, ncol=6)+
        theme_minimal(base_family = myfont, base_size = 15)+
        theme(legend.position='none',
              panel.border = element_rect(size = .5, fill = NA))
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;&lt;a href=&quot;/images/170205/hmd-sex-ratios.png&quot;&gt;&lt;img src=&quot;/images/170205/hmd-sex-ratios.png&quot; alt=&quot;gg&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;There is quite a variety in the sex ratio profiles. If the initial prevalence of males equalizes in Japan, Sweden, or Norway at around 60, in Russia, Belarus, and Ukraine this happens at around 30 due to very high male mortality. In many countries there are pronounced bumps in the sex ratio at ages 20-30, that are likely to be caused by international migration. For example, Scotland, Northern Ireland, Portugal, and New Zealand are experiencing substantial outflow of young men.&lt;/p&gt;

&lt;p&gt;What happened in Taiwan?&lt;/p&gt;

&lt;p&gt;&lt;em&gt;This post is based on my earlier &lt;a href=&quot;https://twitter.com/ikashnitsky/status/785973218775478273&quot;&gt;twit&lt;/a&gt; and &lt;a href=&quot;https://gist.github.com/ikashnitsky/a578eaef6b122aa2aa2e3469fd2dcbe7&quot;&gt;gist&lt;/a&gt;.&lt;/em&gt;&lt;/p&gt;

&lt;div class=&quot;footnotes&quot;&gt;
  &lt;ol&gt;
    &lt;li id=&quot;fn:1&quot;&gt;
      &lt;p&gt;There are cases of big deviations from this natural constant. The most well known one is the skewed sex ratio in China, where decades of One Child Policy together with strong traditional son preference resulted in selective abortions. Read more: Frejka et. al (&lt;a href=&quot;http://dx.doi.org/10.1111/j.1728-4457.2010.00347.x&quot;&gt;2010&lt;/a&gt;); Wang (&lt;a href=&quot;http://dx.doi.org/10.1111/j.1728-4457.2011.00383.x&quot;&gt;2011&lt;/a&gt;); Basten and Verropoulou (&lt;a href=&quot;http://dx.doi.org/10.1080/00324728.2013.826372&quot;&gt;2013&lt;/a&gt;).&amp;nbsp;&lt;a href=&quot;#fnref:1&quot; class=&quot;reversefootnote&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
    &lt;/li&gt;
  &lt;/ol&gt;
&lt;/div&gt;</content><author><name>Ilya Kashnitsky</name><email>ilya.kashnitsky@gmail.com</email></author><summary type="html">Sex ratios reflect the two basic regularities of human demographics: 1) there are always more boys being born; 2) males experience higher mortality throughout their life-course. The sex ratio at birth does not vary dramatically1 and is more or less constant at the level of 105-106 boys per 100 girls. Hence, differences in the sex ratio profiles of countries mainly reflect gender gap in mortality. In this post I will compare sex ratios age profiles in all countries included in Human Mortality Database.


  
    
      There are cases of big deviations from this natural constant. The most well known one is the skewed sex ratio in China, where decades of One Child Policy together with strong traditional son preference resulted in selective abortions. Read more: Frejka et. al (2010); Wang (2011); Basten and Verropoulou (2013).&amp;nbsp;&amp;#8617;</summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="http://localhost:4000/%7B%22teaser%22=%3E%22170205-teaser.png%22%7D" /></entry><entry><title type="html">Hello R world post</title><link href="http://localhost:4000/2017/hello-r-world/" rel="alternate" type="text/html" title="Hello R world post" /><published>2017-01-29T00:00:00+01:00</published><updated>2017-01-29T00:00:00+01:00</updated><id>http://localhost:4000/2017/hello-r-world</id><content type="html" xml:base="http://localhost:4000/2017/hello-r-world/">&lt;p&gt;Welcome to my blog!&lt;/p&gt;

&lt;p&gt;My name is Ilya, I am a demographer. Here I plan to post some research related stuff. As I am crazy about &lt;a href=&quot;https://www.r-project.org&quot;&gt;R&lt;/a&gt;, my post will touch upon this tool/environment – I will share some tricks and cool visualizations. Eventually, I hope to contribute to the amazing &lt;a href=&quot;https://www.r-bloggers.com&quot;&gt;R-bloggers&lt;/a&gt; project. First, I am going to post older bits – to gain momentum.&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;Just to start with, let me show you a small and handy self-written R function. &lt;br /&gt;
Quite often, visualizing data in R, we compose color palettes manually. It is nice to have a function that shows the actual colors of a vector with color values. Here it is.&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;glimpse_colors &amp;lt;- function(colors_string){
        n &amp;lt;- length(colors_string)
        hist(1:n, breaks = 0:n, col = colors_string)
}
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;The function takes a vector of colors as input and produces a basic uniform histogram with one bar for each color, filled accordingly. Let’s try it out. First, we create some colors, and then visualize them.&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;library(RColorBrewer)
pal &amp;lt;- brewer.pal(n = 9, name = 'BrBG')
glimpse_colors(pal)
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;&lt;a href=&quot;/images/170129/pal.png&quot;&gt;&lt;img src=&quot;/images/170129/pal.png&quot; alt=&quot;pal&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Enjoy!&lt;/p&gt;

&lt;p&gt;P.S. If something similar exists in one of the well known packages, please tell me.&lt;/p&gt;</content><author><name>Ilya Kashnitsky</name><email>ilya.kashnitsky@gmail.com</email></author><summary type="html">Welcome to my blog!</summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="http://localhost:4000/%7B%22teaser%22=%3E%22170129-teaser.png%22%7D" /></entry></feed>
